<div class="profile-container">
  <div class="profile-header">
    <h1 class="profile-title">Mon profil</h1>
    <p class="profile-subtitle">Gérez vos informations personnelles et vos préférences</p>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    <p>{{ error }}</p>
  </div>

  <div class="profile-card" *ngIf="!loading && !error && user">
    <div class="profile-tabs">
      <div class="profile-tab" [class.active]="activeTab === 'profile'" (click)="switchTab('profile')">
        Information personnelles
      </div>
      <div class="profile-tab" [class.active]="activeTab === 'password'" (click)="switchTab('password')">
        Modifier le mot de passe
      </div>
      <div class="profile-tab" [class.active]="activeTab === 'history'" (click)="switchTab('history')">
        Historique d'activité
      </div>
      <div class="profile-tab" [class.active]="activeTab === 'formations'" (click)="switchTab('formations')" 
           *ngIf="user.role === 'formateur' || user.role === 'admin'">
        Mes formations
      </div>
      <div class="profile-tab" [class.active]="activeTab === 'services'" (click)="switchTab('services')"
           *ngIf="user.role === 'admin'">
        Mes services
      </div>
    </div>

    <div class="profile-content">
      <!-- Onglet Information personnelles -->
      <div *ngIf="activeTab === 'profile'">
        <div class="user-info">
          <h3>{{ user.nom }}</h3>
          <p>{{ user.email }}</p>
          <span [ngClass]="['user-role', 'role-' + (user.role || 'user')]">
            {{ user.role === 'admin' ? 'Administrateur' : user.role === 'formateur' ? 'Formateur' : 'Utilisateur' }}
          </span>
        </div>

        <div *ngIf="updateProfileSuccess" class="alert alert-success">
          <p>Vos informations ont été mises à jour avec succès !</p>
        </div>

        <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
          <div class="form-group">
            <label for="name" class="form-label">Nom complet</label>
            <input 
              type="text" 
              id="name" 
              formControlName="nom" 
              class="form-control" 
              [class.is-invalid]="profileForm.get('nom')?.invalid && profileForm.get('nom')?.touched"
            >
            <div class="invalid-feedback" *ngIf="profileForm.get('nom')?.invalid && profileForm.get('nom')?.touched">
              <span *ngIf="profileForm.get('nom')?.errors?.['required']">Le nom est requis</span>
              <span *ngIf="profileForm.get('nom')?.errors?.['minlength']">Le nom doit contenir au moins 3 caractères</span>
            </div>
          </div>

          <div class="form-group">
            <label for="email" class="form-label">E-mail</label>
            <input 
              type="email" 
              id="email" 
              formControlName="email" 
              class="form-control"
              [class.is-invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
            >
            <div class="invalid-feedback" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
              <span *ngIf="profileForm.get('email')?.errors?.['required']">L'e-mail est requis</span>
              <span *ngIf="profileForm.get('email')?.errors?.['email']">L'e-mail n'est pas valide</span>
            </div>
          </div>

          <button 
            type="submit" 
            class="submit-btn"
            [disabled]="profileForm.invalid || updatingProfile"
          >
            <span *ngIf="updatingProfile">Mise à jour...</span>
            <span *ngIf="!updatingProfile">Mettre à jour le profil</span>
          </button>
        </form>
      </div>

      <!-- Onglet Mot de passe -->
      <div *ngIf="activeTab === 'password'">
        <div *ngIf="updatePasswordSuccess" class="alert alert-success">
          <p>Votre mot de passe a été mis à jour avec succès !</p>
        </div>

        <div *ngIf="passwordError" class="alert alert-danger">
          <p>{{ passwordError }}</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()">
          <div class="form-group">
            <label for="currentPassword" class="form-label">Mot de passe actuel</label>
            <input 
              type="password" 
              id="currentPassword" 
              formControlName="currentPassword" 
              class="form-control"
              [class.is-invalid]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
            >
            <div class="invalid-feedback" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
              Le mot de passe actuel est requis
            </div>
          </div>

          <div class="form-group">
            <label for="newPassword" class="form-label">Nouveau mot de passe</label>
            <input 
              type="password" 
              id="newPassword" 
              formControlName="newPassword" 
              class="form-control"
              [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
            >
            <div class="invalid-feedback" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
              <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">Le nouveau mot de passe est requis</span>
              <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Le nouveau mot de passe doit contenir au moins 6 caractères</span>
            </div>
          </div>

          <div class="form-group">
            <label for="confirmPassword" class="form-label">Confirmer le nouveau mot de passe</label>
            <input 
              type="password" 
              id="confirmPassword" 
              formControlName="confirmPassword" 
              class="form-control"
              [class.is-invalid]="(passwordForm.get('confirmPassword')?.invalid || passwordForm.hasError('passwordMismatch')) && passwordForm.get('confirmPassword')?.touched"
            >
            <div class="invalid-feedback" *ngIf="(passwordForm.get('confirmPassword')?.invalid || passwordForm.hasError('passwordMismatch')) && passwordForm.get('confirmPassword')?.touched">
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">La confirmation du mot de passe est requise</span>
              <span *ngIf="passwordForm.hasError('passwordMismatch')">Les mots de passe ne correspondent pas</span>
            </div>
          </div>

          <button 
            type="submit" 
            class="submit-btn"
            [disabled]="passwordForm.invalid || updatingPassword"
          >
            <span *ngIf="updatingPassword">Mise à jour...</span>
            <span *ngIf="!updatingPassword">Mettre à jour le mot de passe</span>
          </button>
        </form>
      </div>

      <!-- Onglet Historique d'activité -->
      <div *ngIf="activeTab === 'history'">
        <p class="my-3 text-center">Cette fonctionnalité sera disponible prochainement.</p>
        <!-- Ici, vous pourriez ajouter un historique des activités de l'utilisateur -->
      </div>
      
      <!-- Onglet Mes formations -->
      <div *ngIf="activeTab === 'formations'">
        <h3 class="section-title">Mes formations</h3>
        
        <div *ngIf="loadingFormations" class="text-center my-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
        
        <div *ngIf="formationsError" class="alert alert-info">
          <p>{{ formationsError }}</p>
        </div>
        
        <div *ngIf="!loadingFormations && !formationsError && userFormations.length === 0" class="alert alert-info">
          <p>Vous n'avez pas encore créé de formations.</p>
        </div>
        
        <div class="formation-list" *ngIf="!loadingFormations && userFormations.length > 0">
          <div class="formation-card" *ngFor="let formation of userFormations">
            <div class="formation-header">
              <img [src]="formation.image || 'assets/images/placeholder.jpg'" alt="{{ formation.titre }}" class="formation-image">
              <h4 class="formation-title">{{ formation.titre }}</h4>
            </div>
            <div class="formation-body">
              <p class="formation-category">{{ formation.categorie }}</p>
              <p class="formation-price">{{ formation.prix | currency:'EUR' }}</p>
              <p class="formation-duration">{{ formation.duree }}</p>
            </div>
            <div class="formation-actions">
              <a [routerLink]="['/formations', formation._id]" class="btn btn-outline-primary btn-sm">Voir</a>
              <a [routerLink]="['/formations', formation._id, 'edit']" class="btn btn-outline-secondary btn-sm ms-2">Modifier</a>
            </div>
          </div>        </div>
        
        <div class="text-center mt-4">
          <a routerLink="formation/new" class="btn btn-primary">Créer une nouvelle formation</a>
        </div>
      </div>
      
      <!-- Onglet Mes services -->
      <div *ngIf="activeTab === 'services'">
        <h3 class="section-title">Mes services</h3>
        
        <div *ngIf="loadingServices" class="text-center my-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
        
        <div *ngIf="servicesError" class="alert alert-info">
          <p>{{ servicesError }}</p>
        </div>
        
        <div *ngIf="!loadingServices && !servicesError && userServices.length === 0" class="alert alert-info">
          <p>Vous n'avez pas encore créé de services.</p>
        </div>
        
        <div class="service-list" *ngIf="!loadingServices && userServices.length > 0">
          <div class="service-card" *ngFor="let service of userServices">
            <div class="service-header">
              <img [src]="service.image || 'assets/images/placeholder.jpg'" alt="{{ service.titre }}" class="service-image">
              <h4 class="service-title">{{ service.titre }}</h4>
            </div>
            <div class="service-body">
              <p class="service-category">{{ service.categorie }}</p>
              <p class="service-price">{{ service.prix | currency:'EUR' }}</p>
            </div>
            <div class="service-actions">
              <a [routerLink]="['/services', service._id]" class="btn btn-outline-primary btn-sm">Voir</a>
              <a [routerLink]="['/services', service._id, 'edit']" class="btn btn-outline-secondary btn-sm ms-2">Modifier</a>
            </div>
          </div>
        </div>
          <div class="text-center mt-4">
          <a routerLink="service/new" class="btn btn-primary">Créer un nouveau service</a>
        </div>
      </div>
      
      <button class="logout-btn" (click)="logout()">
        Se déconnecter
      </button>
    </div>
  </div>
</div>
